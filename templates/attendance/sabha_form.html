{% extends 'base.html' %}

{% block title %}{{ title }} - Temple Attendance{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12 col-md-8">
        <div class="card">
            <div class="card-header">
                <h4><i class="fas fa-calendar-plus"></i> {{ title }}</h4>
            </div>
            <div class="card-body">
                <form method="post">
                    {% csrf_token %}
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Xetra <span class="text-danger">*</span></label>
                                <input type="text" name="xetra" class="form-control" value="Palanpur" required>
                                <div class="form-text">Default: Palanpur</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Mandal <span class="text-danger">*</span></label>
                                <select name="mandal" class="form-select" required>
                                    <option value="">Select Mandal</option>
                                    {% if allowed_mandals %}
                                        {% for mandal in allowed_mandals %}
                                            <option value="{{ mandal }}">{{ mandal|title }}</option>
                                        {% endfor %}
                                    {% endif %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Date</label>
                                <input type="date" name="date" class="form-control" min="{{ today }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Sabha Type</label>
                                <select name="sabha_type" class="form-select" required>
                                    <option value="">Select Sabha Type</option>
                                    {% if allowed_sabha_types %}
                                        {% for sabha_type in allowed_sabha_types %}
                                            {% if sabha_type == 'bal' %}
                                                <option value="bal">Bal Sabha</option>
                                            {% elif sabha_type == 'yuvak' %}
                                                <option value="yuvak">Yuvak Sabha</option>
                                            {% elif sabha_type == 'yuvati' %}
                                                <option value="yuvati">Yuvati Sabha</option>
                                            {% elif sabha_type == 'mahila' %}
                                                <option value="mahila">Mahila Sabha</option>
                                            {% elif sabha_type == 'sanyukt-purush' %}
                                                <option value="sanyukt-purush">Sanyukt Purush Sabha</option>
                                            {% elif sabha_type == 'sanyukt-mahila' %}
                                                <option value="sanyukt-mahila">Sanyukt Mahila Sabha</option>
                                            {% endif %}
                                        {% endfor %}
                                    {% else %}
                                        <option value="">No sabha types available</option>
                                    {% endif %}
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Location</label>
                        <input type="text" name="location" class="form-control" required>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Start Time</label>
                                <input type="time" name="start_time" class="form-control" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">End Time</label>
                                <input type="time" name="end_time" class="form-control" required>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex flex-column flex-sm-row justify-content-between gap-2">
                        <a href="{% url 'sabha_list' %}" class="btn btn-secondary">Cancel</a>
                        <button type="submit" class="btn btn-temple" id="createSabhaBtn">
                            <span id="createBtnText">Create Sabha</span>
                            <span id="createBtnLoader" class="d-none">
                                <div class="spinner-border spinner-border-sm me-2" role="status"></div>
                                Creating & marking absent...
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const createBtn = document.getElementById('createSabhaBtn');
    const btnText = document.getElementById('createBtnText');
    const btnLoader = document.getElementById('createBtnLoader');
    
    if (form && createBtn) {
        form.addEventListener('submit', function(e) {
            createBtn.disabled = true;
            btnText.classList.add('d-none');
            btnLoader.classList.remove('d-none');
        });
    }
});
</script>
{% endblock %}